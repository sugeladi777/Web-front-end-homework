# 实现思路

## 时间管理

利用 timeManager.js 进行跨网页的时间管理，在其中编写了 vTime 类管理时间的增加和减少，处理时间的进位和借位。最终实现了一个基本的时间管理系统，能够在不同页面自动更新当前时间和计时器时间，并在设定的时间点触发闹钟提醒。通过 localStorage 存储和读取时间数据，确保页面刷新后时间数据不会丢失。

## **闹钟功能**

**添加闹钟 (addAlarm 函数)**：

从本地存储中获取现有的闹钟列表。创建一个新的闹钟对象，并将其添加到闹钟列表中。对闹钟列表按时间进行排序（先按小时，再按分钟）。将更新后的闹钟列表保存回本地存储。
**格式化时间 (formatTime 函数)**：

将小时和分钟格式化为两位数的字符串（例如，9:5 会被格式化为 09:05）。
返回格式化后的时间字符串。
**展示闹钟 (displayAlarms 函数)**：

从本地存储中获取现有的闹钟列表。清空当前显示的闹钟列表。遍历闹钟列表，为每个闹钟创建一个显示元素，包括时间、名称和删除按钮。为删除按钮添加点击事件，点击后从本地存储中删除对应的闹钟，并刷新显示。
**页面加载时的初始化 (window.onload 函数)**：

为添加闹钟按钮添加点击事件，点击后获取用户输入的时间和名称，检查是否已有相同时间的闹钟或输入是否为空，然后调用 addAlarm 和 displayAlarms 函数。初始化闹钟显示。为返回按钮添加点击事件，点击后跳转到主页面。为时间输入框添加输入事件，限制输入的小时在 0-23 之间，分钟在 0-59 之间。

## 计时器功能

**初始化和事件绑定**：

在 DOMContentLoaded 事件中，初始化计时器状态（从 localStorage 中读取之前保存的时间）。根据是否有暂停时间或计时器时间为零，决定显示“开始”按钮还是“暂停”按钮，并绑定相应的事件处理函数。绑定“返回”按钮和“重置”按钮的点击事件。为时间输入框绑定输入事件，限制输入的时间范围。
**启动计时 (handleStart)**：

从输入框获取用户输入的时间，并将其转换为 vTime 对象。如果存在暂停时间，则继续从暂停时间开始计时。将计时器时间保存到 localStorage 中，并移除暂停时间。使用 setInterval 定时调用 updateClock 函数更新显示时间。更新按钮文字为“暂停”，并切换事件处理函数。
**暂停计时 (handlePause)**：

从 localStorage 中获取当前计时器时间，并将其保存为暂停时间。清除定时器，停止更新显示时间。更新按钮文字为“开始计时”，并切换事件处理函数。
**更新时钟 (updateClock)**：

每隔一定时间（interval）调用一次，减少计时器时间并更新显示。如果时间到达零，则调用 handlePause 停止计时。更新数字显示和时钟指针的角度。

**重置计时器**：
清除计时器时间和暂停时间，并刷新页面。

## 秒表功能

**初始化时间和变量**：

从 localStorage 获取当前时间并初始化 vTime 对象。初始化秒表时间为 0。
**事件监听器**：

开始按钮：点击开始按钮时，启动秒表并更新显示，同时将按钮文本改为“暂停”。再次点击时，暂停秒表并将按钮文本改为“开始”。
返回按钮：点击返回按钮时，跳转到主页面。
重置按钮：点击重置按钮时，刷新页面以重置秒表。
**更新时钟显示**：

使用 setInterval 定时调用 updateClock 函数，每隔 10 毫秒更新一次时钟显示。updateClock 函数更新虚拟时间，并根据当前时间计算时、分、秒和毫秒的角度，更新时钟指针的旋转角度。

## 时钟的拖动效果
**事件监听器**：

利用“冒泡”机制为clock添加事件监听器，用event.target获取事件真正发生的元素。
利用光标位置计算指针需要旋转的角度。同时注意指针的联动。

**对时间的维护**：

在拖动过程中，注意对时间的维护，利用指针旋转的角度计算时间，并使用变量pm来确保24进制；

**设置拖动效果setdrag()**:

在文档加载完成后进行事件监听器的添加；

**计算偏转角度slopeToDeg(dx,dy)**:

通过斜率来计算指针要旋转的角度；

**指针联动handLinkage(ddeg, dragHand, clockwise)**：

ddeg：变化的角度；<br>
dragHand：被拖动的指针；<br>
clockwise：是否以顺时针或逆时针的方式度过了一圈：<br>
返回对应的三个指针各自的偏转角度；

**更新时间updateTime()**:

针对指针的角度获得当前时间，要注意维持24进制；

# 使用说明
1. 在拖动过程中，首先需要点击指针上的旋钮，再进行拖动；

# 遇到问题及解决办法

# 参考文献
