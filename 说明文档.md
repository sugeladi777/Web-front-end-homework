# 成员分工

申诗哲：闹钟秒表和计时器功能、表盘美化
刘海昡：鼠标拨动设置时间功能、页面布局美化
李承锴：表盘绘制和指针走动功能、代码风格维护、色彩搭配与背景设计
薛文瀚：数字时间显示与参数设置时间功能、按钮与字体美化

# 实现思路

## 时间管理

利用 timeManager.js 进行跨网页的时间管理，在其中编写了 vTime 类管理时间的增加和减少，处理时间的进位和借位。最终实现了一个基本的时间管理系统，能够在不同页面自动更新当前时间和计时器时间，并在设定的时间点触发闹钟提醒。通过 localStorage 存储和读取时间数据，确保页面刷新后时间数据不会丢失。

## **闹钟功能**

**添加闹钟 (addAlarm 函数)**：

从本地存储中获取现有的闹钟列表。创建一个新的闹钟对象，并将其添加到闹钟列表中。对闹钟列表按时间进行排序（先按小时，再按分钟）。将更新后的闹钟列表保存回本地存储。
**格式化时间 (formatTime 函数)**：

将小时和分钟格式化为两位数的字符串（例如，9:5 会被格式化为 09:05）。
返回格式化后的时间字符串。
**展示闹钟 (displayAlarms 函数)**：

从本地存储中获取现有的闹钟列表。清空当前显示的闹钟列表。遍历闹钟列表，为每个闹钟创建一个显示元素，包括时间、名称和删除按钮。为删除按钮添加点击事件，点击后从本地存储中删除对应的闹钟，并刷新显示。
**页面加载时的初始化 (window.onload 函数)**：

为添加闹钟按钮添加点击事件，点击后获取用户输入的时间和名称，检查是否已有相同时间的闹钟或输入是否为空，然后调用 addAlarm 和 displayAlarms 函数。初始化闹钟显示。为返回按钮添加点击事件，点击后跳转到主页面。为时间输入框添加输入事件，限制输入的小时在 0-23 之间，分钟在 0-59 之间。

## 计时器功能

**初始化和事件绑定**：

在 DOMContentLoaded 事件中，初始化计时器状态（从 localStorage 中读取之前保存的时间）。根据是否有暂停时间或计时器时间为零，决定显示“开始”按钮还是“暂停”按钮，并绑定相应的事件处理函数。绑定“返回”按钮和“重置”按钮的点击事件。为时间输入框绑定输入事件，限制输入的时间范围。
**启动计时 (handleStart)**：

从输入框获取用户输入的时间，并将其转换为 vTime 对象。如果存在暂停时间，则继续从暂停时间开始计时。将计时器时间保存到 localStorage 中，并移除暂停时间。使用 setInterval 定时调用 updateClock 函数更新显示时间。更新按钮文字为“暂停”，并切换事件处理函数。
**暂停计时 (handlePause)**：

从 localStorage 中获取当前计时器时间，并将其保存为暂停时间。清除定时器，停止更新显示时间。更新按钮文字为“开始计时”，并切换事件处理函数。
**更新时钟 (updateClock)**：

每隔一定时间（interval）调用一次，减少计时器时间并更新显示。如果时间到达零，则调用 handlePause 停止计时。更新数字显示和时钟指针的角度。

**重置计时器**：
清除计时器时间和暂停时间，并刷新页面。

## 秒表功能

**初始化时间和变量**：

从 localStorage 获取当前时间并初始化 vTime 对象。初始化秒表时间为 0。
**事件监听器**：

开始按钮：点击开始按钮时，启动秒表并更新显示，同时将按钮文本改为“暂停”。再次点击时，暂停秒表并将按钮文本改为“开始”。
返回按钮：点击返回按钮时，跳转到主页面。
重置按钮：点击重置按钮时，刷新页面以重置秒表。
**更新时钟显示**：

使用 setInterval 定时调用 updateClock 函数，每隔 10 毫秒更新一次时钟显示。updateClock 函数更新虚拟时间，并根据当前时间计算时、分、秒和毫秒的角度，更新时钟指针的旋转角度。

## 数字时间显示

**构建数字表盘**

使用 div 标签分级嵌套，分为 background、timenumber、partition 等部分，实现数字表盘的结构

**更新时分秒显示**

在 updateClock()函数中获取当前时间，并通过 updateDigit()函数修改数字表盘对应数字.

**数字改变动画**

在 updateDigit()函数中设置数字变化的动画效果，每次数字更新后会进行放大缩小。

## 时分秒设置

**事件监听器**

功能按钮：根据用户点击按钮的不同，跳转到不同功能界面。点击“设置时间”按钮
输入文本框：用户进行输入后会判断其是否为合适范围内的时间值。
确认按钮：点击确认后，会将 realTime 设为 false，根据输入的时间参数更新 vtime，并存储时间值。

**获取时间参数**

通过三个 type 为 number 的 input 文本框分别获取用户输入的时分秒。

**时间合法性检测**

在点击确认后，会判断三个文本框的输入是否为合法数字，若不是则弹出提示框“请输入合法的时间”。

## 时钟的拖动效果

**事件监听器**：

利用“冒泡”机制为 clock 添加事件监听器，用 event.target 获取事件真正发生的元素。
利用光标位置计算指针需要旋转的角度。同时注意指针的联动。

**对时间的维护**：

在拖动过程中，注意对时间的维护，利用指针旋转的角度计算时间，并使用变量 pm 来确保 24 进制；

**设置拖动效果 setdrag()**:

在文档加载完成后进行事件监听器的添加；

**计算偏转角度 slopeToDeg(dx,dy)**:

通过斜率来计算指针要旋转的角度；

**指针联动 handLinkage(ddeg, dragHand, clockwise)**：

ddeg：变化的角度；<br>
dragHand：被拖动的指针；<br>
clockwise：是否以顺时针或逆时针的方式度过了一圈：<br>
返回对应的三个指针各自的偏转角度；

**更新时间 updateTime()**:

针对指针的角度获得当前时间，要注意维持 24 进制；

# 使用说明

1. 在拖动过程中，需要拖动指针上的圆形旋钮，才会有效果；
2. 点击侧边栏进入闹钟界面，右下角可以输入时间和名称添加闹钟，闹钟列表上有删除按钮可以删除闹钟，时间到时会弹窗并响铃
3. 点击侧边栏进入计时器页面，可以设置时间和开始计时，可以暂停和归零，时间到时会弹窗并响铃
4. 点击侧边栏进入秒表页面，可以点击开始进行计时，可以暂停和归零。大圈指示秒钟，小圈指示分钟。
5. 点击“当前时间”，设置时间为电脑本地时间
6. 点击“设置时间”，弹出设置时间窗口

# 遇到问题及解决办法

1. 成员间协作出现疑问，通过线上会议和 github 协同工作解决
2. 代码排版不统一，通过 vscode 的 Prettier 插件解决

# 参考文献

1. 本课程视频和课程资料
